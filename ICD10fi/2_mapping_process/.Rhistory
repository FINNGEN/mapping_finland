select(CodeId, English_name, Code1, Code2) %>%  print((n=100))
same_concept <- ICD10fi_standard %>% count(ShortName, LongName, sort = T) %>% filter(n>1) %>%  .$LongName
ICD10fi_standard %>% filter(LongName %in% same_concept) %>% arrange(LongName) %>%
select(CodeId, English_name, Code1, Code2) %>%  print((n=100))
same_concept <- ICD10fi_standard %>% count(ShortName, LongName, sort = T) %>% filter(n>1) %>%  .$LongName
ICD10fi_standard %>% filter(LongName %in% same_concept) %>% arrange(LongName) %>%
select(CodeId, English_name, Code1, Code2) %>%  print(n=100)
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(scales)
library(stringdist)
# Chunk 2: load
ICD10fi_standard <- read_delim("../1_source_files/58_1471433699473.txt", ";",
locale = locale(encoding = 'ISO-8859-1'),
col_types = cols( .default = col_character() )
)
ICD10fi_standard <- ICD10fi_standard %>% select(CodeId, ShortName,	LongName, ParentId,	HierarchyLevel,
BeginningDate,	ExpiringDate, 'A:Koodi1', 'A:Koodi2',
'A:Long_name'
) %>%
rename(Code1 = 'A:Koodi1', Code2 = 'A:Koodi2', English_name = 'A:Long_name' ) %>%
mutate(BeginningDate = dmy(BeginningDate), ExpiringDate = dmy(ExpiringDate))
ICD10who_OMOP <- read_csv("../1_source_files/OMOP_ICD10who.csv")
# Chunk 3
ICD10fi_standard  %>% nrow
# Chunk 4
same_concept <- ICD10fi_standard %>% count(ShortName, LongName, sort = T) %>% filter(n>1) %>%  .$LongName
ICD10fi_standard %>% filter(LongName %in% same_concept) %>% arrange(LongName) %>%
select(CodeId, English_name, Code1, Code2)# %>%  print(n=100)
# Chunk 5
ICD10fi_standard_classif <- ICD10fi_standard  %>% filter( grepl("-", CodeId))
# Chunk 6
ICD10fi_standard_classif  %>% nrow
# match ICD10fi codes to the ICD10who codes
ICD10fi_standard_match_icd10who <- inner_join(ICD10fi_standard,
ICD10who_OMOP %>% rename(CodeId = concept_code),
by = "CodeId")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(scales)
library(stringdist)
ICD10fi_standard <- read_delim("../1_source_files/58_1471433699473.txt", ";",
locale = locale(encoding = 'ISO-8859-1'),
col_types = cols( .default = col_character() )
)
ICD10fi_standard <- ICD10fi_standard %>% select(CodeId, ShortName,	LongName, ParentId,	HierarchyLevel,
BeginningDate,	ExpiringDate, 'A:Koodi1', 'A:Koodi2',
'A:Long_name'
) %>%
rename(Code1 = 'A:Koodi1', Code2 = 'A:Koodi2', English_name = 'A:Long_name' ) %>%
mutate(BeginningDate = dmy(BeginningDate), ExpiringDate = dmy(ExpiringDate))
ICD10who_OMOP <- read_csv("../1_source_files/OMOP_ICD10who.csv")
ICD10fi_standard  %>% nrow
same_concept <- ICD10fi_standard %>% count(ShortName, LongName, sort = T) %>% filter(n>1) %>%  .$LongName
ICD10fi_standard %>% filter(LongName %in% same_concept) %>% arrange(LongName) %>%
select(CodeId, English_name, Code1, Code2)# %>%  print(n=100)
ICD10fi_standard_classif <- ICD10fi_standard  %>% filter( grepl("-", CodeId))
ICD10fi_standard_classif  %>% nrow
# match ICD10fi codes to the ICD10who codes
ICD10fi_standard_match_icd10who <- inner_join(ICD10fi_standard,
ICD10who_OMOP %>% rename(CodeId = concept_code),
by = "CodeId")
ICD10fi_standard_match_icd10who %>% nrow
ICD10fi_standard_match_icd10who  %>%  select(CodeId, English_name, concept_name, ShortName) %>%
mutate(same_name = stringdist(English_name,concept_name) )  %>%
count(same_name, sort = T) %>% head(20)
# match ICD10fi's diagnose codes to the ICD10who codes
matched_ids <- c(ICD10fi_standard_classif$CodeId, ICD10fi_standard_match_icd10who$CodeId)
ICD10fi_standard_match_icd10who_2 <-
inner_join( ICD10fi_standard  %>% filter(!(CodeId %in% matched_ids)) %>%
mutate(CodeId = str_sub(CodeId, 1, -2)),
ICD10who_OMOP %>% rename(Code1 = concept_code),
by = "Code1")
ICD10fi_standard_match_icd10who_2
ICD10fi_standard_match_icd10who_2 %>%  select(CodeId, English_name)
ICD10fi_standard  %>% filter(!(CodeId %in% matched_ids)) %>%
mutate(CodeId = str_sub(CodeId, 1, -2))
# match ICD10fi's diagnose codes to the ICD10who codes
matched_ids <- c(ICD10fi_standard_classif$CodeId, ICD10fi_standard_match_icd10who$CodeId)
ICD10fi_standard_match_icd10who_2 <-
inner_join( ICD10fi_standard  %>% filter(!(CodeId %in% matched_ids)) %>%
mutate(CodeId = str_sub(CodeId, 1, -2)),
ICD10who_OMOP %>% rename(Code1 = concept_code),
by = "Code1")
# match ICD10fi's diagnose codes to the ICD10who codes
matched_ids <- c(ICD10fi_standard_classif$CodeId, ICD10fi_standard_match_icd10who$CodeId)
ICD10fi_standard_match_icd10who_2 <-
inner_join( ICD10fi_standard  %>% filter(!(CodeId %in% matched_ids)) %>%
mutate(CodeId = str_sub(CodeId, 1, -2)),
ICD10who_OMOP %>% rename(Code1 = concept_code),
by = "CodeId")
# match ICD10fi's diagnose codes to the ICD10who codes
matched_ids <- c(ICD10fi_standard_classif$CodeId, ICD10fi_standard_match_icd10who$CodeId)
ICD10fi_standard_match_icd10who_2 <-
inner_join( ICD10fi_standard  %>% filter(!(CodeId %in% matched_ids)) %>%
mutate(CodeId = str_sub(CodeId, 1, -2)),
ICD10who_OMOP %>% rename(CodeId = concept_code),
by = "CodeId")
ICD10fi_standard_match_icd10who_2
ICD10fi_standard_match_icd10who_2 %>%  select(CodeId, English_name)
ICD10fi_standard_match_icd10who_2 %>%  select(CodeId, English_name, ShortName)
# match ICD10fi's diagnose codes to the ICD10who codes
matched_ids <- c(ICD10fi_standard_classif$CodeId, ICD10fi_standard_match_icd10who$CodeId)
ICD10fi_standard_match_icd10who_2 <-
inner_join( ICD10fi_standard  %>% filter(!(CodeId %in% matched_ids)) %>%
mutate(CodeId_modified = str_sub(CodeId, 1, -2)),
ICD10who_OMOP %>% rename(CodeId_modified = concept_code),
by = "CodeId_modified")
ICD10fi_standard_match_icd10who_2 %>%  select(CodeId, CodeId_modified, English_name, ShortName)
# match ICD10fi's diagnose codes to the ICD10who codes
matched_ids <- c(ICD10fi_standard_classif$CodeId, ICD10fi_standard_match_icd10who$CodeId)
ICD10fi_standard_match_icd10who_2 <-
inner_join( ICD10fi_standard  %>% filter(!(CodeId %in% matched_ids)) %>%
mutate(CodeId_modified = str_replace(CodeId, "\\*|\\+|\\&|\\#", "")),
ICD10who_OMOP %>% rename(CodeId_modified = concept_code),
by = "CodeId_modified")
ICD10fi_standard_match_icd10who_2 %>%  select(CodeId, CodeId_modified, English_name, ShortName)
ICD10fi_standard %>% filter(str_detect(CodeId, "A18.7"))
ICD10fi_standard %>% filter(str_detect(CodeId, "A18.7"))  %>%  select(CodeId, CodeId_modified, English_name, ShortName)
ICD10fi_standard %>% filter(str_detect(CodeId, "A18.7"))  %>%  select(CodeId,  English_name, ShortName)
ICD10fi_standard %>% filter(str_detect(CodeId, "A18.7"))  %>%  select(CodeId,  English_name, ShortName, LongName)
# match ICD10fi's diagnose codes to the ICD10who codes
matched_ids <- c(ICD10fi_standard_classif$CodeId, ICD10fi_standard_full_match_icd10who$CodeId)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(scales)
library(stringdist)
ICD10fi_standard <- read_delim("../1_source_files/58_1471433699473.txt", ";",
locale = locale(encoding = 'ISO-8859-1'),
col_types = cols( .default = col_character() )
)
ICD10fi_standard <- ICD10fi_standard %>% select(CodeId, ShortName,	LongName, ParentId,	HierarchyLevel,
BeginningDate,	ExpiringDate, 'A:Koodi1', 'A:Koodi2',
'A:Long_name'
) %>%
rename(Code1 = 'A:Koodi1', Code2 = 'A:Koodi2', English_name = 'A:Long_name' ) %>%
mutate(BeginningDate = dmy(BeginningDate), ExpiringDate = dmy(ExpiringDate))
ICD10who_OMOP <- read_csv("../1_source_files/OMOP_ICD10who.csv")
ICD10fi_standard  %>% nrow
same_concept <- ICD10fi_standard %>% count(ShortName, LongName, sort = T) %>% filter(n>1) %>%  .$LongName
ICD10fi_standard %>% filter(LongName %in% same_concept) %>% arrange(LongName) %>%
select(CodeId, English_name, Code1, Code2)# %>%  print(n=100)
ICD10fi_standard_classif <- ICD10fi_standard  %>% filter( grepl("-", CodeId))
ICD10fi_standard_classif  %>% nrow
# match ICD10fi codes to the ICD10who codes
ICD10fi_standard_full_match_icd10who <- inner_join(ICD10fi_standard,
ICD10who_OMOP %>% rename(CodeId = concept_code),
by = "CodeId")
ICD10fi_standard_full_match_icd10who %>% nrow
# match ICD10fi's diagnose codes to the ICD10who codes
matched_ids <- c(ICD10fi_standard_classif$CodeId, ICD10fi_standard_full_match_icd10who$CodeId)
ICD10fi_standard_almostfull_match_icd10who <-
inner_join( ICD10fi_standard  %>% filter(!(CodeId %in% matched_ids)) %>%
mutate(CodeId_modified = str_replace(CodeId, "\\*|\\+|\\&|\\#", "")),
ICD10who_OMOP %>% rename(CodeId_modified = concept_code),
by = "CodeId_modified")
ICD10fi_standard_almostfull_match_icd10who %>% nrow
ICD10fi_standard_almostfull_match_icd10who
ICD10fi_standard_full_match_icd10who %>% filter(CodeId %in% ICD10fi_standard_almostfull_match_icd10who$CodeId_modified)
ICD10fi_standard_almostfull_match_icd10who %>% filter(CodeId == "B59")
ICD10fi_standard_almostfull_match_icd10who %>% filter(CodeId_modified == "B59")
ICD10fi_standard_full_match_icd10who %>% filter(LongName %in% ICD10fi_standard_almostfull_match_icd10who$LongName)
ICD10fi_standard_full_match_icd10who %>% filter(CodeId %in% ICD10fi_standard_almostfull_match_icd10who$CodeId_modified) %>%  nrow
ICD10fi_standard_full_match_icd10who  %>%
select(CodeId, English_name, concept_name, ShortName) %>%
mutate(same_name = stringdist(English_name,concept_name) )  %>%
count(same_name, sort = T) %>% head(20)
ICD10fi_standard_almostfull_match_icd10who  %>%
select(CodeId, English_name, concept_name, ShortName) %>%
mutate(same_name = stringdist(English_name,concept_name) )  %>%
count(same_name, sort = T) %>% head(20)
ICD10fi_standard_full_match_icd10who  %>%
select(CodeId, English_name, concept_name, ShortName) %>%
mutate(same_name = stringdist(English_name,concept_name) )  %>%
count(same_name, sort = T) %>% head(20)
ICD10fi_standard_almostfull_match_icd10who  %>%
select(CodeId, English_name, concept_name, ShortName) %>%
mutate(same_name = stringdist(English_name,concept_name) )  %>%
count(same_name, sort = T) %>% head(20)
ICD10fi_standard_full_match_icd10who  %>%  select(CodeId, English_name, concept_name, ShortName) %>%
mutate(same_name = stringdist(English_name,concept_name) )  %>%
rename(ICD10fi_name = English_name, ICD10who_name = concept_name) %>%
filter(same_name>21)  %>% head(20)
ICD10fi_standard_full_match_icd10who  %>%  select(CodeId, English_name, concept_name, ShortName) %>%
mutate(same_name = stringdist(English_name,concept_name) )  %>%
rename(ICD10fi_name = English_name, ICD10who_name = concept_name) %>%
filter(same_name>21)  %>% head(20)
rename(ICD10fi_name = English_name, ICD10who_name = concept_name) %>%
filter(same_name>21)  %>% head(20)
ICD10fi_standard_almostfull_match_icd10who  %>%  select(CodeId, English_name, concept_name, ShortName) %>%
mutate(same_name = stringdist(English_name,concept_name) )  %>%
count(same_name, sort = T) %>% head(20)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(scales)
library(stringdist)
ICD10fi_standard <- read_delim("../1_source_files/58_1471433699473.txt", ";",
locale = locale(encoding = 'ISO-8859-1'),
col_types = cols( .default = col_character() )
)
ICD10fi_standard <- ICD10fi_standard %>% select(CodeId, ShortName,	LongName, ParentId,	HierarchyLevel,
BeginningDate,	ExpiringDate, 'A:Koodi1', 'A:Koodi2',
'A:Long_name'
) %>%
rename(Code1 = 'A:Koodi1', Code2 = 'A:Koodi2', English_name = 'A:Long_name' ) %>%
mutate(BeginningDate = dmy(BeginningDate), ExpiringDate = dmy(ExpiringDate))
ICD10who_OMOP <- read_csv("../1_source_files/OMOP_ICD10who.csv")
ICD10fi_standard  %>% nrow
same_concept <- ICD10fi_standard %>% count(ShortName, LongName, sort = T) %>% filter(n>1) %>%  .$LongName
ICD10fi_standard %>% filter(LongName %in% same_concept) %>% arrange(LongName) %>%
select(CodeId, English_name, Code1, Code2)# %>%  print(n=100)
ICD10fi_standard_classif <- ICD10fi_standard  %>% filter( grepl("-", CodeId))
ICD10fi_standard_classif  %>% nrow
# match ICD10fi codes to the ICD10who codes
ICD10fi_standard_full_match_icd10who <- inner_join(ICD10fi_standard,
ICD10who_OMOP %>% rename(CodeId = concept_code),
by = "CodeId")
ICD10fi_standard_full_match_icd10who %>% nrow
ICD10fi_standard_full_match_icd10who  %>%  select(CodeId, English_name, concept_name, ShortName) %>%
mutate(same_name = stringdist(English_name,concept_name) )  %>%
count(same_name, sort = T) %>% head(20)
ICD10fi_standard_full_match_icd10who  %>%  select(CodeId, English_name, concept_name, ShortName) %>%
mutate(same_name = stringdist(English_name,concept_name) )  %>%
rename(ICD10fi_name = English_name, ICD10who_name = concept_name) %>%
filter(same_name>21)  %>% head(20)
# match ICD10fi's diagnose codes to the ICD10who codes
matched_ids <- c(ICD10fi_standard_classif$CodeId, ICD10fi_standard_full_match_icd10who$CodeId)
ICD10fi_standard_almostfull_match_icd10who <-
inner_join( ICD10fi_standard  %>% filter(!(CodeId %in% matched_ids)) %>%
mutate(CodeId_modified = str_replace(CodeId, "\\*|\\+|\\&|\\#", "")),
ICD10who_OMOP %>% rename(CodeId_modified = concept_code),
by = "CodeId_modified")
ICD10fi_standard_almostfull_match_icd10who %>% nrow
ICD10fi_standard_full_match_icd10who %>% filter(CodeId %in% ICD10fi_standard_almostfull_match_icd10who$CodeId_modified)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(scales)
library(stringdist)
ICD10fi_standard <- read_delim("../1_source_files/58_1471433699473.txt", ";",
locale = locale(encoding = 'ISO-8859-1'),
col_types = cols( .default = col_character() )
)
ICD10fi_standard <- ICD10fi_standard %>% select(CodeId, ShortName,	LongName, ParentId,	HierarchyLevel,
BeginningDate,	ExpiringDate, 'A:Koodi1', 'A:Koodi2',
'A:Long_name'
) %>%
rename(Code1 = 'A:Koodi1', Code2 = 'A:Koodi2', English_name = 'A:Long_name' ) %>%
mutate(BeginningDate = dmy(BeginningDate), ExpiringDate = dmy(ExpiringDate))
ICD10who_OMOP <- read_csv("../1_source_files/OMOP_ICD10who.csv")
ICD10fi_standard  %>% nrow
same_concept <- ICD10fi_standard %>% count(ShortName, LongName, sort = T) %>% filter(n>1) %>%  .$LongName
ICD10fi_standard %>% filter(LongName %in% same_concept) %>% arrange(LongName) %>%
select(CodeId, English_name, Code1, Code2)# %>%  print(n=100)
ICD10fi_standard_classif <- ICD10fi_standard  %>% filter( grepl("-", CodeId))
ICD10fi_standard_classif  %>% nrow
# match ICD10fi codes to the ICD10who codes
ICD10fi_standard_full_match_icd10who <- inner_join(ICD10fi_standard,
ICD10who_OMOP %>% rename(CodeId = concept_code),
by = "CodeId")
ICD10fi_standard_full_match_icd10who %>% nrow
ICD10fi_standard_full_match_icd10who  %>%  select(CodeId, English_name, concept_name, ShortName) %>%
mutate(same_name = stringdist(English_name,concept_name) )  %>%
count(same_name, sort = T) %>% head(20)
ICD10fi_standard_full_match_icd10who  %>%  select(CodeId, English_name, concept_name, ShortName) %>%
mutate(same_name = stringdist(English_name,concept_name) )  %>%
rename(ICD10fi_name = English_name, ICD10who_name = concept_name) %>%
filter(same_name>21)  %>% head(20)
# match ICD10fi's diagnose codes to the ICD10who codes
matched_ids <- c(ICD10fi_standard_classif$CodeId, ICD10fi_standard_full_match_icd10who$CodeId)
ICD10fi_standard_almostfull_match_icd10who <-
inner_join( ICD10fi_standard  %>% filter(!(CodeId %in% matched_ids)) %>%
mutate(CodeId_modified = str_replace(CodeId, "\\*|\\+|\\&|\\#", "")),
ICD10who_OMOP %>% rename(CodeId_modified = concept_code),
by = "CodeId_modified")
ICD10fi_standard_almostfull_match_icd10who %>% nrow
ICD10fi_standard_full_match_icd10who %>% filter(CodeId %in% ICD10fi_standard_almostfull_match_icd10who$CodeId_modified)
# match ICD10fi's diagnose codes to the ICD10who codes
matched_ids <- c(ICD10fi_standard_classif$CodeId,
ICD10fi_standard_full_match_icd10who$CodeId,
ICD10fi_standard_almostfull_match_icd10who$CodeId)
ICD10fi_standard_code1_match_icd10who <- inner_join( ICD10fi_standard  %>% filter(!(CodeId %in% matched_ids)) ,
ICD10who_OMOP %>% rename(Code1 = concept_code),
by = "Code1")
ICD10fi_standard_code1_match_icd10who  %>% nrow
matched_ids <- c(ICD10fi_standard_classif$CodeId,
ICD10fi_standard_full_match_icd10who$CodeId,
ICD10fi_standard_almostfull_match_icd10who$CodeId,
ICD10fi_standard_code1_match_icd10who$CodeId)
ICD10fi_standard_new <- ICD10fi_standard  %>% filter(!(CodeId %in% matched_ids))
ICD10fi_standard_new %>%  nrow()
#which are new in the level higher than 6
ICD10fi_standard_new  %>%
select(CodeId, English_name, ShortName) %>%
mutate(group = nchar(CodeId) #str_sub(concept_code, 0, 1)
) %>% filter(group<6)
# what groups have more new ones
ICD10fi_standard_new  %>%
select(CodeId, English_name, ShortName) %>%
mutate(group = str_sub(CodeId, 0, 1)) %>% count(group, sort = T)
# Join all
ICD10fi_standard_matched <- bind_rows(
# classifiction codes
ICD10fi_standard  %>% filter( CodeId %in%ICD10fi_standard_classif$CodeId)  %>%
mutate(ICD10who = as.character(NA), ICD10who_match_level = "classification" ),
# perfect matches
ICD10fi_standard  %>% filter( CodeId %in%ICD10fi_standard_full_match_icd10who$CodeId)  %>%
mutate(ICD10who = CodeId, ICD10who_match_level = "full_match" ),
# perfect matches
ICD10fi_standard  %>% filter( CodeId %in%ICD10fi_standard_almostfull_match_icd10who$CodeId)  %>% select(-CodeId_modified) %>%
mutate(ICD10who = CodeId, ICD10who_match_level = "full_match" ),
# matched with the diagnose
ICD10fi_standard  %>% filter( CodeId %in%ICD10fi_standard_code1_match_icd10who$CodeId)  %>%
mutate(ICD10who = Code1, ICD10who_match_level = "diagnose_match" ),
#
ICD10fi_standard_new_1 %>% select(CodeId:ICD10who)%>%
mutate(ICD10who_match_level = "diagnose_match_parent" ),
#
ICD10fi_standard_new_2 %>% select(CodeId:ICD10who)%>%
mutate(ICD10who_match_level =  "diagnose_match_grandparent" )
)%>% arrange(CodeId)  %>%
mutate(ICD10who_match_level = factor(ICD10who_match_level,
levels = c("classification",
"full_match",
"diagnose_match",
"diagnose_match_parent",
"diagnose_match_grandparent")
)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(scales)
library(stringdist)
ICD10fi_standard <- read_delim("../1_source_files/58_1471433699473.txt", ";",
locale = locale(encoding = 'ISO-8859-1'),
col_types = cols( .default = col_character() )
)
ICD10fi_standard <- ICD10fi_standard %>% select(CodeId, ShortName,	LongName, ParentId,	HierarchyLevel,
BeginningDate,	ExpiringDate, 'A:Koodi1', 'A:Koodi2',
'A:Long_name'
) %>%
rename(Code1 = 'A:Koodi1', Code2 = 'A:Koodi2', English_name = 'A:Long_name' ) %>%
mutate(BeginningDate = dmy(BeginningDate), ExpiringDate = dmy(ExpiringDate))
ICD10who_OMOP <- read_csv("../1_source_files/OMOP_ICD10who.csv")
ICD10fi_standard  %>% nrow
same_concept <- ICD10fi_standard %>% count(ShortName, LongName, sort = T) %>% filter(n>1) %>%  .$LongName
ICD10fi_standard %>% filter(LongName %in% same_concept) %>% arrange(LongName) %>%
select(CodeId, English_name, Code1, Code2)# %>%  print(n=100)
ICD10fi_standard_classif <- ICD10fi_standard  %>% filter( grepl("-", CodeId))
ICD10fi_standard_classif  %>% nrow
# match ICD10fi codes to the ICD10who codes
ICD10fi_standard_full_match_icd10who <- inner_join(ICD10fi_standard,
ICD10who_OMOP %>% rename(CodeId = concept_code),
by = "CodeId")
ICD10fi_standard_full_match_icd10who %>% nrow
ICD10fi_standard_full_match_icd10who  %>%  select(CodeId, English_name, concept_name, ShortName) %>%
mutate(same_name = stringdist(English_name,concept_name) )  %>%
count(same_name, sort = T) %>% head(20)
ICD10fi_standard_full_match_icd10who  %>%  select(CodeId, English_name, concept_name, ShortName) %>%
mutate(same_name = stringdist(English_name,concept_name) )  %>%
rename(ICD10fi_name = English_name, ICD10who_name = concept_name) %>%
filter(same_name>21)  %>% head(20)
# match ICD10fi's diagnose codes to the ICD10who codes
matched_ids <- c(ICD10fi_standard_classif$CodeId, ICD10fi_standard_full_match_icd10who$CodeId)
ICD10fi_standard_almostfull_match_icd10who <-
inner_join( ICD10fi_standard  %>% filter(!(CodeId %in% matched_ids)) %>%
mutate(CodeId_modified = str_replace(CodeId, "\\*|\\+|\\&|\\#", "")),
ICD10who_OMOP %>% rename(CodeId_modified = concept_code),
by = "CodeId_modified")
ICD10fi_standard_almostfull_match_icd10who %>% nrow
ICD10fi_standard_full_match_icd10who %>% filter(CodeId %in% ICD10fi_standard_almostfull_match_icd10who$CodeId_modified)
ICD10fi_standard_almostfull_match_icd10who  %>%  select(CodeId, English_name, concept_name, ShortName) %>%
mutate(same_name = stringdist(English_name,concept_name) )  %>%
count(same_name, sort = T) %>% head(20)
# match ICD10fi's diagnose codes to the ICD10who codes
matched_ids <- c(ICD10fi_standard_classif$CodeId,
ICD10fi_standard_full_match_icd10who$CodeId,
ICD10fi_standard_almostfull_match_icd10who$CodeId)
ICD10fi_standard_code1_match_icd10who <- inner_join( ICD10fi_standard  %>% filter(!(CodeId %in% matched_ids)) ,
ICD10who_OMOP %>% rename(Code1 = concept_code),
by = "Code1")
ICD10fi_standard_code1_match_icd10who  %>% nrow
matched_ids <- c(ICD10fi_standard_classif$CodeId,
ICD10fi_standard_full_match_icd10who$CodeId,
ICD10fi_standard_almostfull_match_icd10who$CodeId,
ICD10fi_standard_code1_match_icd10who$CodeId)
ICD10fi_standard_new <- ICD10fi_standard  %>% filter(!(CodeId %in% matched_ids))
ICD10fi_standard_new %>%  nrow()
#which are new in the level higher than 6
ICD10fi_standard_new  %>%
select(CodeId, English_name, ShortName) %>%
mutate(group = nchar(CodeId) #str_sub(concept_code, 0, 1)
) %>% filter(group<6)
# what groups have more new ones
ICD10fi_standard_new  %>%
select(CodeId, English_name, ShortName) %>%
mutate(group = str_sub(CodeId, 0, 1)) %>% count(group, sort = T)
# ICD10fi code matches the ICD10who
ICD10fi_standard_clas <- ICD10fi_standard  %>%
filter( CodeId %in% ICD10who_OMOP$concept_code)  %>%
mutate( ICD10who = CodeId , ICD10who_match_level = 0 )
# match diagnose codes to the upper level code
ICD10fi_standard_new_1 <- inner_join( ICD10fi_standard_new  %>%
# remove the last digit of the code
mutate(ICD10who = str_sub(Code1, 0, -2))%>%
# remove the last digit of the code if it is a point
mutate(ICD10who = sub("\\.$", "", ICD10who)) ,
ICD10who_OMOP %>% rename(ICD10who = concept_code),
by = "ICD10who")
ICD10fi_standard_new_1  %>%  nrow
# match diagnose codes to the upper level code
ICD10fi_standard_new_2 <- left_join( ICD10fi_standard_new  %>% filter( !(CodeId %in% ICD10fi_standard_new_1$CodeId)) %>%
# remove the last digit of the code
mutate(ICD10who = str_sub(Code1, 0, -3))%>%
# remove the last digit of the code if it is a point
mutate(ICD10who = sub("\\.$", "", ICD10who)) ,
ICD10who_OMOP %>% rename(ICD10who = concept_code),
by = "ICD10who")
ICD10fi_standard_new_2 %>%  nrow
# Join all
ICD10fi_standard_matched <- bind_rows(
# classifiction codes
ICD10fi_standard  %>% filter( CodeId %in%ICD10fi_standard_classif$CodeId)  %>%
mutate(ICD10who = as.character(NA), ICD10who_match_level = "classification" ),
# perfect matches
ICD10fi_standard  %>% filter( CodeId %in%ICD10fi_standard_full_match_icd10who$CodeId)  %>%
mutate(ICD10who = CodeId, ICD10who_match_level = "full_match" ),
# perfect matches
ICD10fi_standard  %>% filter( CodeId %in%ICD10fi_standard_almostfull_match_icd10who$CodeId)  %>% select(-CodeId_modified) %>%
mutate(ICD10who = CodeId, ICD10who_match_level = "full_match" ),
# matched with the diagnose
ICD10fi_standard  %>% filter( CodeId %in%ICD10fi_standard_code1_match_icd10who$CodeId)  %>%
mutate(ICD10who = Code1, ICD10who_match_level = "diagnose_match" ),
#
ICD10fi_standard_new_1 %>% select(CodeId:ICD10who)%>%
mutate(ICD10who_match_level = "diagnose_match_parent" ),
#
ICD10fi_standard_new_2 %>% select(CodeId:ICD10who)%>%
mutate(ICD10who_match_level =  "diagnose_match_grandparent" )
)%>% arrange(CodeId)  %>%
mutate(ICD10who_match_level = factor(ICD10who_match_level,
levels = c("classification",
"full_match",
"diagnose_match",
"diagnose_match_parent",
"diagnose_match_grandparent")
)
ICD10fi_standard  %>% filter( CodeId %in%ICD10fi_standard_classif$CodeId)  %>%
mutate(ICD10who = as.character(NA), ICD10who_match_level = "classification" )
# Join all
ICD10fi_standard_matched <- bind_rows(
# classifiction codes
ICD10fi_standard  %>% filter( CodeId %in%ICD10fi_standard_classif$CodeId)  %>%
mutate(ICD10who = as.character(NA), ICD10who_match_level = "classification" ),
# perfect matches
ICD10fi_standard  %>% filter( CodeId %in%ICD10fi_standard_full_match_icd10who$CodeId)  %>%
mutate(ICD10who = CodeId, ICD10who_match_level = "full_match" ),
# perfect matches
ICD10fi_standard  %>% filter( CodeId %in%ICD10fi_standard_almostfull_match_icd10who$CodeId)  %>%
mutate(ICD10who = CodeId, ICD10who_match_level = "full_match" ),
# matched with the diagnose
ICD10fi_standard  %>% filter( CodeId %in%ICD10fi_standard_code1_match_icd10who$CodeId)  %>%
mutate(ICD10who = Code1, ICD10who_match_level = "diagnose_match" ),
#
ICD10fi_standard_new_1 %>% select(CodeId:ICD10who)%>%
mutate(ICD10who_match_level = "diagnose_match_parent" ),
#
ICD10fi_standard_new_2 %>% select(CodeId:ICD10who)%>%
mutate(ICD10who_match_level =  "diagnose_match_grandparent" )
)%>% arrange(CodeId)  %>%
mutate(ICD10who_match_level = factor(ICD10who_match_level,
levels = c("classification",
"full_match",
"diagnose_match",
"diagnose_match_parent",
"diagnose_match_grandparent")
)
ICD10fi_standard_matched  %>% count(ICD10who_match_level)
# Join all
ICD10fi_standard_matched <- bind_rows(
# classifiction codes
ICD10fi_standard  %>% filter( CodeId %in%ICD10fi_standard_classif$CodeId)  %>%
mutate(ICD10who = as.character(NA), ICD10who_match_level = "classification" ),
# perfect matches
ICD10fi_standard  %>% filter( CodeId %in%ICD10fi_standard_full_match_icd10who$CodeId)  %>%
mutate(ICD10who = CodeId, ICD10who_match_level = "full_match" ),
# perfect matches
ICD10fi_standard  %>% filter( CodeId %in%ICD10fi_standard_almostfull_match_icd10who$CodeId)  %>%
mutate(ICD10who = CodeId, ICD10who_match_level = "almosfull_match" ),
# matched with the diagnose
ICD10fi_standard  %>% filter( CodeId %in%ICD10fi_standard_code1_match_icd10who$CodeId)  %>%
mutate(ICD10who = Code1, ICD10who_match_level = "diagnose_match" ),
#
ICD10fi_standard_new_1 %>% select(CodeId:ICD10who)%>%
mutate(ICD10who_match_level = "diagnose_match_parent" ),
#
ICD10fi_standard_new_2 %>% select(CodeId:ICD10who)%>%
mutate(ICD10who_match_level =  "diagnose_match_grandparent" )
)%>% arrange(CodeId)  %>%
mutate(ICD10who_match_level = factor(ICD10who_match_level,
levels = c("classification",
"full_match",
"diagnose_match",
"diagnose_match_parent",
"diagnose_match_grandparent")
)
ICD10fi_standard_matched  %>% count(ICD10who_match_level)
